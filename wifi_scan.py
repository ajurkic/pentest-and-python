#!/usr/bin/python

#Suppress Scapy IPv6 warning
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

import os
from scapy.all import *
from multiprocessing import Process

os.system("clear")
access_points=set()

def channel_hopper():
    while True:
        try:
            for channel in range(1,14):
                os.system("iw dev wlan0mon set channel %d" % channel)
                time.sleep(1)
        except KeyboardInterrupt:
            break

def packet_handler(pkt):
    if pkt.haslayer(Dot11Beacon):
       if pkt.info and (pkt.info not in access_points):
           print len(access_points)+1, pkt.addr3, pkt.info
           access_points.add(pkt.info)

if __name__ == "__main__":
    try:
        p = Process(target = channel_hopper)
        p.start()
        sniff(iface="wlan0mon", prn=packet_handler)
    except KeyboardInterrupt:
        p.terminate()
        p.join()

"""
Destination MAC - pkt.addr1
Source MAC - pkt.addr2
BSSID - pkt.addr3
"""