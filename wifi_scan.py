#!/usr/bin/python

#Suppress Scapy IPv6 warning
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

from scapy.all import *
from multiprocessing import Process
import threading, os, sys, signal

os.system("clear")
os.system("airmon-ng start wlan0 > /dev/null 2>&1")
print("[*] Switching wireless card into monitor mode...\n")
access_points = set()

def signal_handler(signal, frame):
    print("\n---------- Quiting... ----------\n")
    os.system("kill -9 " + (str(os.getpid())) )
    sys.exit(1)

def channel_hopper():
    while True:
        for channel in range(1,14):
            os.system("iw dev wlan0mon set channel %d" % channel)
            print("----------CH %d----------" % channel)
            time.sleep(0.3)

def packet_handler(pkt):
    if pkt.haslayer(Dot11Beacon):
       if pkt.info and (pkt.info not in access_points):
           print len(access_points)+1, pkt.addr3, pkt.info
           access_points.add(pkt.info)

if __name__ == "__main__":
    signal.signal(signal.SIGINT, signal_handler) #For catching Ctrl+C
    p = threading.Thread(target = channel_hopper)
    p.start()
    sniff(iface="wlan0mon", prn=packet_handler)
