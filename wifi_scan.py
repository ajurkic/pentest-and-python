#!/usr/bin/python

#Suppress Scapy IPv6 warning
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

from scapy.all import *
import multiprocessing, os, sys

os.system("clear")
os.system("airmon-ng start wlan0 > /dev/null 2>&1")
print("[*] Switching wireless card into monitor mode...\n")
access_points = set()

def channel_hopper():
    while True:
        for channel in range(1,14):
            os.system("iw dev wlan0mon set channel %d" % channel)
            time.sleep(0.1)

def packet_handler(pkt):
    if pkt.haslayer(Dot11Beacon):
       if pkt.info and (pkt.info not in access_points):
           print len(access_points)+1, pkt.addr3, pkt.info
           access_points.add(pkt.info)

if __name__ == "__main__":
    p = multiprocessing.Process(target = channel_hopper)
    p.start()
    sniff(iface="wlan0mon", prn=packet_handler)
    
    #if all fails:
    #kill -9 `ps -ef | grep test.py | grep -v grep | awk '{print $2}'`

    p.terminate()
    print p.is_alive() # Why is it still alive!?
    
    choice = raw_input("Choose number of an access point as target: ")
    print choice