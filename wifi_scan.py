#!/usr/bin/python

#Suppress Scapy IPv6 warning
import logging
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

import os
from scapy.all import *
from multiprocessing import Process #multithreading pogledat, umisto multiprocessing
import threading

os.system("clear")
os.system("airmon-ng start wlan0 > /dev/null 2>&1")
access_points=set()

def channel_hopper():
    self = threading.currentThread()
    while getattr(self, "flag", True):7
        for channel in range(1,14):
            os.system("iw dev wlan0mon set channel %d" % channel)
            print "xxxx"
            time.sleep(1)


def packet_handler(pkt):
    if pkt.haslayer(Dot11Beacon):
       if pkt.info and (pkt.info not in access_points):
           print len(access_points)+1, pkt.addr3, pkt.info
           access_points.add(pkt.info)

if __name__ == "__main__":
    try:
        p = threading.Thread(target = channel_hopper)
        p.start()
        sniff(iface="wlan0mon", prn=packet_handler)
        while True:
            time.sleep(0.2)
    except KeyboardInterrupt:
        p.flag = False
        

"""
Destination MAC - pkt.addr1
Source MAC - pkt.addr2
BSSID - pkt.addr3
"""